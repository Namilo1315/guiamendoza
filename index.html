<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Guía de Comercios</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>

  <style>
    :root{
      --primary:#007bff;
      --accent:#00a5fe;
      --soft:#f6f8fb;
      --text:#1f2a37;
    }
    html, body {
  font-size: 14px; /* o 15px si querés un poco más grande */
}

    body{background:var(--soft);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    .shadow-smooth{box-shadow:0 10px 25px rgba(0,0,0,.08)}
    .card{border:0;border-radius:18px}
    .card-hover{transition:transform .18s ease,box-shadow .18s ease}
    .card-hover:hover{transform:translateY(-3px);box-shadow:0 12px 30px rgba(0,0,0,.10)}
    .avatar{
      width:56px;height:56px;border-radius:999px;display:flex;align-items:center;justify-content:center;
      font-weight:800;background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;letter-spacing:.5px
    }
    .hero{
      background: radial-gradient(1200px 400px at 10% -20%, #67c1ff44, transparent 60%),
                  radial-gradient(1000px 500px at 110% 10%, #00a5fe22, transparent 60%),
                  linear-gradient(90deg, #4facfe, #00a5fe);
      color:#fff
      
    }
    .hero .badge{background:rgba(255,255,255,.18);backdrop-filter: blur(6px)}
    .filter-btn{
      border-radius:999px;border:2px solid #0d6efd;background:transparent;color:#0d6efd;font-weight:700
    }
    .filter-btn.active,.filter-btn:hover{background:#0d6efd;color:#ffffff}
    .btn-rubro{
      border-radius:999px;border:2px solid var(--primary);background:#fff;color:var(--primary);font-weight:700;
      padding:.5rem 1rem
    }
    .btn-rubro.active,.btn-rubro:hover{background:var(--primary);color:#fff}
    .search-wrap{background:#fff;border-radius:16px}
    .carousel-item img{height:300px;object-fit:cover;border-radius:16px}
    .whatsapp-fab{
      position:fixed;right:18px;bottom:18px;width:56px;height:56px;border-radius:999px;background:#25d366;color:#fff;
      display:flex;align-items:center;justify-content:center;font-size:26px;z-index:1055;box-shadow:0 10px 20px rgba(0,0,0,.2)
    }
    .footer{background:#0b1324;color:#cbd5e1}
    @media (max-width: 1200px) {
  html, body {
    font-size: 13px;
  }
}
  </style>
</head>
<body>

<!-- ====================== HERO / HEADER ====================== -->
<header class="hero py-5 position-relative overflow-hidden shadow-sm">
  <div class="container">
    <div class="row align-items-center gy-4">
      <div class="col-lg-7">
        <span class="badge rounded-pill px-3 py-2 mb-3">Guía local</span>
        <h1 class="display-5 fw-bold mb-3">
          <i class="bi bi-shop-window me-2"></i> Encontrá y sumá tu comercio
        </h1>
        <p class="lead mb-4">Explorá comercios por rubro, hablá por WhatsApp en un toque y registrá el tuyo <br> para aparecer en la guía.</p>
        <div class="d-flex flex-wrap gap-2">
          <button class="btn btn-light btn-lg rounded-pill fw-bold px-4" data-bs-toggle="modal" data-bs-target="#modalRegistro">
            <i class="bi bi-shop me-2"></i> Registrar mi comercio
          </button>
          <button class="btn btn-outline-light btn-lg rounded-pill fw-bold px-4" data-bs-toggle="modal" data-bs-target="#modalCatalogo">
            <i class="bi bi-gift me-2"></i> Catálogo Día de la Madre
          </button>
        </div>
      </div>
      <div class="col-lg-5 text-center">
        <div class="search-wrap p-3 shadow-smooth">
          <div class="input-group">
            <span class="input-group-text bg-white border-0"><i class="bi bi-search text-primary"></i></span>
            <input id="searchInput" class="form-control border-0" placeholder="Buscar por nombre, dirección o rubro...">
          </div>
          <div class="mt-3 d-flex flex-wrap gap-2 justify-content-center">
            <button class="filter-btn btn px-3 py-2 active" data-rubro="todos">Todos</button>
            <button class="filter-btn btn px-3 py-2" data-rubro="Peluquería">Peluquería</button>
            <button class="filter-btn btn px-3 py-2" data-rubro="Kiosco">Kiosco</button>
            <button class="filter-btn btn px-3 py-2" data-rubro="Ferretería">Ferretería</button>
            <button class="filter-btn btn px-3 py-2" data-rubro="Panadería">Panadería</button>
            <button class="filter-btn btn px-3 py-2" data-rubro="Verdulería">Verdulería</button>
            <button class="filter-btn btn px-3 py-2" data-rubro="Carnicería">Carnicería</button>
            <button class="filter-btn btn px-3 py-2" data-rubro="Supermercado">Supermercado</button>
            <button class="filter-btn btn px-3 py-2" data-rubro="Indumentaria">Indumentaria</button>
            <button class="filter-btn btn px-3 py-2" data-rubro="Librería">Librería</button>
            <button class="filter-btn btn px-3 py-2" data-rubro="Farmacia">Farmacia</button>
            <button class="filter-btn btn px-3 py-2" data-rubro="Restaurante">Restaurante</button>
            <button class="filter-btn btn px-3 py-2" data-rubro="Mascotas">Mascotas</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- ====================== CARRUSEL PROMOS ====================== -->
<div id="heroCarousel" class="carousel slide my-4 container" data-bs-ride="carousel">
  <div class="carousel-inner">
    <div class="carousel-item active"><img class="d-block w-100" alt="Promo 1"
      src="https://images.unsplash.com/photo-1511690656952-34342bb7c2f2?q=80&w=1600&auto=format&fit=crop"></div>
    <div class="carousel-item"><img class="d-block w-100" alt="Promo 2"
      src="https://images.unsplash.com/photo-1527169402691-feff5539e52c?q=80&w=1600&auto=format&fit=crop"></div>
    <div class="carousel-item"><img class="d-block w-100" alt="Promo 3"
      src="https://images.unsplash.com/photo-1517836357463-d25dfeac3438?q=80&w=1600&auto=format&fit=crop"></div>
  </div>
  <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span><span class="visually-hidden">Anterior</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span><span class="visually-hidden">Siguiente</span>
  </button>
</div>

<!-- ====================== DESTACADOS ====================== -->
<section class="container mt-5">
  <div class="text-center mb-4">
    <h2 class="fw-bold text-primary"><i class="bi bi-star-fill text-warning me-2"></i> Comercios Destacados</h2>
    <p class="text-muted mb-0">Algunos de nuestros favoritos de la semana</p>
  </div>
  <div class="row g-3" id="featuredContainer">
    <!-- Cards con IMG (hardcode de ejemplo profesional) -->
  </div>
</section>

<!-- ====================== TODOS LOS COMERCIOS ====================== -->
<section class="container mt-5">
  <div class="text-center mb-4">
    <h2 class="fw-bold text-primary"><i class="bi bi-shop-window me-2"></i> Todos los Comercios</h2>
    <p class="text-muted mb-0">Se actualiza en tiempo real a medida que se registran</p>
  </div>
  <div class="row g-3" id="comerciosContainer"></div>
</section>

<!-- ====================== MODAL REGISTRO ====================== -->
<div class="modal fade" id="modalRegistro" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4 border-0 shadow-smooth">
      <form id="formRegistro" class="needs-validation" novalidate>
        <div class="modal-header bg-light border-0 rounded-top-4">
          <h5 class="modal-title fw-bold text-success"><i class="bi bi-shop-window me-2"></i>Registrar nuevo comercio</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          <div class="form-floating mb-3">
            <input required type="text" class="form-control" id="regNombre" placeholder="Nombre del comercio">
            <label for="regNombre">Nombre del comercio</label>
            <div class="invalid-feedback">Ingresá el nombre.</div>
          </div>

          <div class="form-floating mb-3">
            <input required type="text" class="form-control" id="regDireccion" placeholder="Dirección">
            <label for="regDireccion">Dirección</label>
            <div class="invalid-feedback">Ingresá la dirección.</div>
          </div>

          <div class="form-floating mb-3">
            <select class="form-select" id="regRubro" required>
              <option value="" selected disabled>Elegí un rubro</option>
              <option>Peluquería</option><option>Kiosco</option><option>Ferretería</option>
              <option>Panadería</option><option>Verdulería</option><option>Carnicería</option>
              <option>Supermercado</option><option>Indumentaria</option><option>Librería</option>
              <option>Farmacia</option><option>Restaurante</option><option>Mascotas</option>
            </select>
            <label for="regRubro">Rubro</label>
            <div class="invalid-feedback">Seleccioná un rubro.</div>
          </div>

          <div class="form-floating mb-3">
            <input required type="tel" class="form-control" id="regWhatsapp" placeholder="WhatsApp (solo números)">
            <label for="regWhatsapp">WhatsApp (solo números, sin 0/15)</label>
            <div class="invalid-feedback">Ingresá el WhatsApp.</div>
          </div>

          <div class="small text-muted">Al guardar, el comercio aparecerá en “Todos los Comercios” y se podrá contactar por WhatsApp.</div>
        </div>
        <div class="modal-footer border-0">
          <button class="btn btn-success w-100 rounded-pill fw-bold" type="submit">
            <i class="bi bi-send me-2"></i>Enviar registro
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- ====================== MODAL CATÁLOGO DÍA DE LA MADRE ====================== -->
<div class="modal fade" id="modalCatalogo" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content rounded-4 border-0">
      <div class="modal-header bg-light border-0 rounded-top-4">
        <h5 class="modal-title fw-bold text-primary"><i class="bi bi-gift me-2"></i> Catálogo Día de la Madre</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="row g-3">
          <!-- Grid simple de catálogo (placeholders elegantes) -->
          <div class="col-6 col-md-3">
            <div class="card card-hover">
              <img src="https://media.istockphoto.com/id/1326570912/es/foto/botella-de-vidrio-de-perfume-sobre-fondo-de-seda-dorada.jpg?s=612x612&w=0&k=20&c=CwXCHOjerFbEIUaHmBNf-ZdUc8UQ5sUCrsHb5QZIVSg=" class="card-img-top" alt="Perfumes">
              <div class="card-body">
                <h6 class="fw-bold mb-1">Perfumes</h6>
                <p class="small text-muted mb-2">Especial Madres</p>
                <a href="https://wa.me/542616246767?text=Hola!%20Quiero%20consultar%20por%20perfumes%20del%20Cat%C3%A1logo%20D%C3%ADa%20de%20la%20Madre" target="_blank" class="btn btn-outline-primary btn-sm w-100">Consultar</a>
              </div>
            </div>
          </div>
          <div class="col-6 col-md-3">
            <div class="card card-hover">
              <img src="https://images.unsplash.com/photo-1516826957135-700dedea698c?q=80&w=1200&auto=format&fit=crop" class="card-img-top" alt="Accesorios">
              <div class="card-body">
                <h6 class="fw-bold mb-1">Accesorios</h6>
                <p class="small text-muted mb-2">Joyas y más</p>
                <a href="https://wa.me/542616246767?text=Hola!%20Quiero%20consultar%20por%20accesorios%20del%20Cat%C3%A1logo%20D%C3%ADa%20de%20la%20Madre" target="_blank" class="btn btn-outline-primary btn-sm w-100">Consultar</a>
              </div>
            </div>
          </div>
          <div class="col-6 col-md-3">
            <div class="card card-hover">
              <img src="https://images.unsplash.com/photo-1512436991641-6745cdb1723f?q=80&w=1200&auto=format&fit=crop" class="card-img-top" alt="Indumentaria">
              <div class="card-body">
                <h6 class="fw-bold mb-1">Indumentaria</h6>
                <p class="small text-muted mb-2">Temporada</p>
                <a href="https://wa.me/542616246767?text=Hola!%20Quiero%20consultar%20por%20indumentaria%20del%20Cat%C3%A1logo%20D%C3%ADa%20de%20la%20Madre" target="_blank" class="btn btn-outline-primary btn-sm w-100">Consultar</a>
              </div>
            </div>
          </div>
          <div class="col-6 col-md-3">
            <div class="card card-hover">
              <img src="https://images.unsplash.com/photo-1520975916090-3105956dac38?q=80&w=1200&auto=format&fit=crop" class="card-img-top" alt="Experiencias">
              <div class="card-body">
                <h6 class="fw-bold mb-1">Experiencias</h6>
                <p class="small text-muted mb-2">Spa & Relax</p>
                <a href="https://wa.me/542616246767?text=Hola!%20Quiero%20consultar%20por%20experiencias%20del%20Cat%C3%A1logo%20D%C3%ADa%20de%20la%20Madre" target="_blank" class="btn btn-outline-primary btn-sm w-100">Consultar</a>
              </div>
            </div>
          </div>
          
        </div>
        
        <div class="small text-muted mt-3"></div>
      </div>
      <div class="modal-footer border-0">
        <button class="btn btn-primary rounded-pill" data-bs-dismiss="modal">Listo</button>
      </div>
    </div>
  </div>
</div>

<!-- ====================== SECCIÓN BENEFICIOS DESTACADO ====================== -->
<section class="container mt-5 py-5">
  <div class="text-center mb-4">
    <h2 class="fw-bold text-primary">
      <i class="bi bi-megaphone-fill me-2"></i> ¡Hacé crecer tu comercio!
    </h2>
    <p class="lead text-muted">
      Con el plan <span class="fw-bold text-warning">DESTACADO</span> tu negocio tendrá más visibilidad y oportunidades.
    </p>
  </div>

  <div class="row g-4">
    <div class="col-md-4 text-center">
      <i class="bi bi-star-fill text-warning display-5"></i>
      <h5 class="fw-bold mt-2">Mayor Visibilidad</h5>
      <p class="small text-muted">
        Tu comercio aparecerá en la sección especial de destacados en la parte superior.
      </p>
    </div>

    <div class="col-md-4 text-center">
      <i class="bi bi-graph-up-arrow text-success display-5"></i>
      <h5 class="fw-bold mt-2">Más Clientes</h5>
      <p class="small text-muted">
        Tus datos estarán siempre a un click en WhatsApp.
      </p>
    </div>

    <div class="col-md-4 text-center">
      <i class="bi bi-heart-fill text-danger display-5"></i>
      <h5 class="fw-bold mt-2">Impulso Local</h5>
      <p class="small text-muted">
        Apoyamos a los emprendedores de Mendoza para crecer juntos.
      </p>
    </div>
  </div>

  <div class="text-center mt-4">
    <a class="btn btn-warning btn-lg rounded-pill fw-bold"
       href="https://wa.me/542616246767?text=Hola!%20Quiero%20ser%20DESTACADO%20en%20la%20gu%C3%ADa."
       target="_blank">
      <i class="bi bi-star-fill me-1"></i> Quiero ser Destacado
    </a>
  </div>
</section>

<!-- ====================== FOOTER ====================== -->
<footer class="footer mt-5 pt-5 pb-4">
  <div class="container">
    <div class="row gy-4">
      <div class="col-md-4">
        <h5 class="text-white fw-bold">Comercios Maipú</h5>
        <p class="text-secondary mb-0">Conectamos personas con negocios locales. Crecemos con vos.</p>
      </div>
      <div class="col-md-4">
        <h6 class="text-white fw-bold mb-2">Contacto</h6>
        <p class="mb-1"><i class="bi bi-geo-alt-fill me-2"></i>Maipú, Mendoza</p>
        <p class="mb-1"><i class="bi bi-envelope me-2"></i>contacto@comerciosmaipu.com</p>
        <p class="mb-0"><i class="bi bi-telephone me-2"></i>+54 261 6246767</p>
      </div>
      <div class="col-md-4">
        <h6 class="text-white fw-bold mb-2">Seguinos</h6>
        <div class="d-flex gap-2">
          <a class="btn btn-outline-success btn-sm" target="_blank" href="https://wa.me/542616246767"><i class="bi bi-whatsapp"></i></a>
          <a class="btn btn-outline-primary btn-sm" href="#"><i class="bi bi-facebook"></i></a>
          <a class="btn btn-outline-danger btn-sm" href="#"><i class="bi bi-instagram"></i></a>
          <a class="btn btn-outline-info btn-sm" href="#"><i class="bi bi-twitter-x"></i></a>
        </div>
      </div>
    </div>
    <hr class="border-secondary my-4">
    <div class="text-center text-secondary small">© 2025 Comercios Maipú — Todos los derechos reservados</div>
  </div>
</footer>

<!-- ====================== WHATSAPP GENERAL (FLOTANTE) ====================== -->
<a class="whatsapp-fab" href="https://wa.me/542616246767" target="_blank" aria-label="WhatsApp general">
  <i class="bi bi-whatsapp"></i>
</a>

<!-- ====================== LIBRERÍAS ====================== -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- ====================== FIREBASE + APP ====================== -->
<script type="module">
  /* ---------------- Firebase (v12.1.0) ---------------- */
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import {
    getFirestore, collection, addDoc, getDocs, onSnapshot, query, orderBy, serverTimestamp
  } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  // Config proporcionada por vos
  const firebaseConfig = {
    apiKey: "AIzaSyC6xVk-lhu3Tl0MysJHvmVA3wTZslLFeWY",
    authDomain: "gestion-postulantes.firebaseapp.com",
    projectId: "gestion-postulantes",
    storageBucket: "gestion-postulantes.firebasestorage.app",
    messagingSenderId: "316005992021",
    appId: "1:316005992021:web:ba86c12b2ab189ac09b6dc"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  /* ---------------- Utilidades UI ---------------- */
  const comerciosContainer = document.getElementById("comerciosContainer");
  const featuredContainer = document.getElementById("featuredContainer");
  const formRegistro = document.getElementById("formRegistro");
  const searchInput = document.getElementById("searchInput");
  const filterBtns = document.querySelectorAll(".filter-btn");

  const FEATURED = [
    {
      nombre: "Panadería Sol",
      descripcion: "Panes y facturas artesanales",
      img: "https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=1400&auto=format&fit=crop",
      rubro: "Panadería",
      whatsapp: "2611234567",
      direccion: "Calle 123, Maipú"
    },
    {
      nombre: "Ferretería El Tornillo",
      descripcion: "Herramientas y hogar",
      img: "https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=1400&auto=format&fit=crop",
      rubro: "Ferretería",
      whatsapp: "2614455666",
      direccion: "Colón 101, Maipú"
    },
    {
      nombre: "Ferretería El Tornillo",
      descripcion: "Herramientas y hogar",
      img: "https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=1400&auto=format&fit=crop",
      rubro: "Ferretería",
      whatsapp: "2614455666",
      direccion: "Colón 101, Maipú"
    }
  ];

  function avatarIniciales(nombre="C"){
    const ini = nombre.trim().split(/\s+/).slice(0,2).map(w=>w[0]?.toUpperCase()||"").join("");
    return `<div class="avatar flex-shrink-0">${ini || "C"}</div>`;
  }

  function waLink(num){ // Opcional: ajustá prefijo país si necesitás distinto
    const limpio = (num||"").replace(/\D/g,"");
    return `https://wa.me/54${limpio}`;
  }

  function comercioCard({nombre, direccion, whatsapp, rubro}){
    return `
      <div class="col-12 col-sm-6 col-lg-4">
        <div class="card card-hover h-100 p-3">
          <div class="d-flex align-items-center gap-3">
            ${avatarIniciales(nombre)}
            <div class="flex-grow-1">
              <h5 class="mb-0 fw-bold text-primary">${nombre}</h5>
              <div class="small text-muted">${rubro||"Sin rubro"}</div>
            </div>
          </div>
          <div class="mt-3">
            <div class="d-flex align-items-start">
              <i class="bi bi-geo-alt-fill text-danger me-2 mt-1"></i>
              <div class="small">${direccion||"—"}</div>
            </div>
          </div>
          <div class="mt-3">
            <a class="btn btn-outline-success w-100 fw-semibold rounded-pill" target="_blank" href="${waLink(whatsapp)}">
              <i class="bi bi-whatsapp me-1"></i> WhatsApp
            </a>
          </div>
        </div>
      </div>`;
  }

  function destacadoCard({nombre, descripcion, img, whatsapp, direccion}){
    return `
      <div class="col-12 col-sm-6 col-lg-4">
        <div class="card card-hover h-100">
          <img src="${img}" class="card-img-top" alt="${nombre}">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title fw-bold text-primary">${nombre}</h5>
            <p class="card-text text-muted small">${descripcion||""}</p>
            <div class="mt-auto">
              <div class="d-flex align-items-start mb-3">
                <i class="bi bi-geo-alt-fill text-danger me-2 mt-1"></i>
                <div class="small">${direccion||"—"}</div>
              </div>
              <a href="${waLink(whatsapp)}" target="_blank" class="btn btn-success w-100 rounded-pill">
                <i class="bi bi-whatsapp me-1"></i> Contactar
              </a>
            </div>
          </div>
        </div>
      </div>`;
  }

  function renderFeatured(){
    featuredContainer.innerHTML = FEATURED.map(destacadoCard).join("");
  }

  // Estado/Cache para filtros y búsqueda
  let todosComercios = [];

  function aplicarRender(){
    const term = (searchInput.value||"").toLowerCase().trim();
    const rubroActivo = document.querySelector(".filter-btn.active")?.dataset?.rubro || "todos";

    const filtrados = todosComercios.filter(c=>{
      const coincideTexto = [c.nombre, c.direccion, c.rubro].filter(Boolean)
        .some(v=>String(v).toLowerCase().includes(term));
      const coincideRubro = rubroActivo==="todos" ? true : (c.rubro===rubroActivo);
      return coincideTexto && coincideRubro;
    });

    comerciosContainer.innerHTML = filtrados.map(comercioCard).join("") || `
      <div class="col-12">
        <div class="alert alert-light border text-center">No hay comercios para mostrar con esos filtros.</div>
      </div>`;
  }

  // Filtros Rubro
  filterBtns.forEach(btn=>{
    btn.addEventListener("click", ()=>{
      filterBtns.forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      aplicarRender();
    });
  });

  // Búsqueda
  searchInput.addEventListener("input", ()=>{
    aplicarRender();
  });

  // Validación del form (Bootstrap)
  (() => {
    formRegistro.addEventListener('submit', async (event) => {
      event.preventDefault();
      event.stopPropagation();
      if (!formRegistro.checkValidity()) {
        formRegistro.classList.add('was-validated');
        return;
      }
      // Guardar en Firestore
      const nombre = document.getElementById("regNombre").value.trim();
      const direccion = document.getElementById("regDireccion").value.trim();
      const rubro = document.getElementById("regRubro").value;
      const whatsapp = document.getElementById("regWhatsapp").value.trim();

      try{
        await addDoc(collection(db,"comercios"),{
          nombre, direccion, rubro, whatsapp,
          createdAt: serverTimestamp()
        });
        formRegistro.reset();
        formRegistro.classList.remove('was-validated');
        bootstrap.Modal.getInstance(document.getElementById("modalRegistro")).hide();
      }catch(e){
        alert("Ocurrió un error al guardar. Intentá nuevamente.");
        console.error(e);
      }
    }, false);
  })();

  // Suscripción en tiempo real
  function suscribirComercios(){
    const q = query(collection(db,"comercios"), orderBy("createdAt","desc"));
    onSnapshot(q, (snap)=>{
      todosComercios = snap.docs.map(d=>({id:d.id, ...d.data()}));
      aplicarRender();
    });
  }

  // Semilla de 2 comercios demo si la colección está vacía
  async function seedSiVacio(){
    const snap = await getDocs(collection(db,"comercios"));
    if(snap.empty){
      await addDoc(collection(db,"comercios"),{
        nombre:"Panadería La Espiga",
        direccion:"Av. San Martín 123",
        rubro:"Panadería",
        whatsapp:"2614567890",
        createdAt: serverTimestamp()
      });
      await addDoc(collection(db,"comercios"),{
        nombre:"Farmacia Central",
        direccion:"Belgrano 456",
        rubro:"Farmacia",
        whatsapp:"2611234567",
        createdAt: serverTimestamp()
      });
    }
  }

  // Inicializar
  renderFeatured();
  await seedSiVacio();
  suscribirComercios();
</script>

</body>
</html>
